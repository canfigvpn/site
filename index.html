<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù¾Ø®Ø´â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø§Ø³ØªØ±ÛŒÙ… Ú†Ù†Ø¯Ú¯Ø§Ù†Ù‡</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.13/dist/hls.min.js"></script>
  <style>
    body { background:#0f0f0f; color:#eee; font-family:Tahoma; margin:0; padding:20px; }
    h1 { text-align:center; color:#0f0; margin-bottom:30px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(520px, 1fr)); gap:25px; max-width:1600px; margin:auto; }
    .card { background:#1a1a1a; border-radius:12px; overflow:hidden; box-shadow:0 4px 25px rgba(0,0,0,0.6); }
    .header { padding:12px 15px; background:#222; display:flex; justify-content:space-between; align-items:center; font-size:14px; }
    video { width:100%; background:#000; }
    input { width:100%; padding:12px; margin:10px 0; background:#222; border:1px solid #444; border-radius:8px; color:#fff; font-size:15px; }
    button { padding:12px 20px; background:#e50914; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; }
  </style>
</head>
<body>
  <h1>ğŸ¬ Ù¾Ø®Ø´â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø§Ø³ØªØ±ÛŒÙ… Ø®ÙˆØ¯Ú©Ø§Ø± (Ú†Ù†Ø¯ Ù¾Ø®Ø´ Ù‡Ù…Ø²Ù…Ø§Ù†)</h1>
  
  <div class="grid" id="players"></div>

  <div style="text-align:center; margin-top:30px;">
    <input type="text" id="newUrl" placeholder="Ù„ÛŒÙ†Ú© Ø§Ø³ØªØ±ÛŒÙ… (m3u8 ÛŒØ§ mp4)" style="width:500px;padding:14px;font-size:16px;">
    <button onclick="addNewPlayer()">â• Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ø®Ø´ Ø¬Ø¯ÛŒØ¯</button>
  </div>

  <script>
    const WORKER_URL = "https://test-tv.netmodvpn-3d1.workers.dev/";   // <<< Ø§ÛŒÙ†Ø¬Ø§ Ø¹ÙˆØ¶ Ú©Ù†!!!

    function createPlayer(streamUrl) {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="header">
          <span>Ù¾Ø®Ø´ ${document.querySelectorAll('.card').length + 1}</span>
          <button onclick="this.closest('.card').remove()">âœ•</button>
        </div>
        <video controls autoplay muted playsinline></video>
      `;
      
      document.getElementById('players').appendChild(card);
      const video = card.querySelector('video');

      // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ù„ÛŒÙ†Ú© Ù¾Ø±ÙˆÚ©Ø³ÛŒ Worker
      const proxied = streamUrl.includes('/proxy?url=') ? streamUrl : 
                     `${WORKER_URL}/proxy?url=${encodeURIComponent(streamUrl)}`;

      if (Hls.isSupported() && (streamUrl.includes('.m3u8') || streamUrl.includes('.m3u'))) {
        const hls = new Hls({ enableWorker: true, lowLatencyMode: true });
        hls.loadSource(proxied);
        hls.attachMedia(video);
      } else {
        video.src = proxied;
      }
      
      video.play().catch(() => {});
    }

    function addNewPlayer() {
      const input = document.getElementById('newUrl');
      if (!input.value.trim()) return alert('Ù„ÛŒÙ†Ú© Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
      createPlayer(input.value.trim());
      input.value = '';
    }

    // Ù…Ø«Ø§Ù„ Ø§ÙˆÙ„ÛŒÙ‡ (Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ú©Ø§Ù…Ù†ØªØ´ Ú©Ù†ÛŒ)
    window.onload = () => {
      // createPlayer('https://test-streams.mux.dev/x264_720p_1500kbs/playlist.m3u8');
    };
  </script>
</body>
</html>
